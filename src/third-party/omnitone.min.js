!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var e=i();for(var n in e)("object"==typeof exports?exports:t)[n]=e[n]}}(this,function(){return function(t){function i(n){if(e[n])return e[n].exports;var s=e[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}var e={};return i.m=t,i.c=e,i.p="",i(0)}([function(t,i,e){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";i.Omnitone=e(1)},function(t,i,e){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";var n={},s=e(2),o=e(3),c=e(4),a=e(5),h=e(6);n.VERSION="0.1.0",n.LOG=function(){window.console.log.apply(window.console,["%c[Omnitone]%c "+Array.prototype.slice.call(arguments).join(" ")+" %c(@"+performance.now().toFixed(2)+"ms)","background: #BBDEFB; color: #FF5722; font-weight: 700","font-weight: 400","color: #AAA"])},n.createFOARouter=function(t,i){return new s(t,i)},n.createFOARotator=function(t){return new o(t)},n.createFOARotator=function(t){return new o(t)},n.createFOAPhaseMatchedFilter=function(t){return new c(t)},n.createFOAVirtualSpeaker=function(t,i){return new a(t,i)},n.createFOADecoder=function(t,i,e){return new h(t,i,e)},t.exports=n},function(t,i){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";function e(t,i){this._context=t,this._splitter=this._context.createChannelSplitter(4),this._merger=this._context.createChannelMerger(4),this._routingDestination=i||n,console.log(this._routingDestination),this._splitter.connect(this._merger,0,this._routingDestination[0]),this._splitter.connect(this._merger,1,this._routingDestination[1]),this._splitter.connect(this._merger,2,this._routingDestination[2]),this._splitter.connect(this._merger,3,this._routingDestination[3]),this.input=this._splitter,this.output=this._merger}var n=[0,1,2,3];e.prototype.setRoutingDestination=function(t){this._routingDestination=t,this._splitter.disconnect(),this._splitter.connect(this._merger,0,this._routingDestination[0]),this._splitter.connect(this._merger,1,this._routingDestination[1]),this._splitter.connect(this._merger,2,this._routingDestination[2]),this._splitter.connect(this._merger,3,this._routingDestination[3])},t.exports=e},function(t,i){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";function e(t){this._context=t,this._splitter=this._context.createChannelSplitter(4),this._inX=this._context.createGain(),this._inY=this._context.createGain(),this._inZ=this._context.createGain(),this._m0=this._context.createGain(),this._m1=this._context.createGain(),this._m2=this._context.createGain(),this._m3=this._context.createGain(),this._m4=this._context.createGain(),this._m5=this._context.createGain(),this._m6=this._context.createGain(),this._m7=this._context.createGain(),this._m8=this._context.createGain(),this._outX=this._context.createGain(),this._outY=this._context.createGain(),this._outZ=this._context.createGain(),this._merger=this._context.createChannelMerger(4),this._splitter.connect(this._inZ,1),this._splitter.connect(this._inX,2),this._splitter.connect(this._inY,3),this._inX.gain.value=-1,this._inZ.gain.value=-1,this._inX.connect(this._m0),this._inX.connect(this._m1),this._inX.connect(this._m2),this._inY.connect(this._m3),this._inY.connect(this._m4),this._inY.connect(this._m5),this._inZ.connect(this._m6),this._inZ.connect(this._m7),this._inZ.connect(this._m8),this._m0.connect(this._outX),this._m1.connect(this._outY),this._m2.connect(this._outZ),this._m3.connect(this._outX),this._m4.connect(this._outY),this._m5.connect(this._outZ),this._m6.connect(this._outX),this._m7.connect(this._outY),this._m8.connect(this._outZ),this._splitter.connect(this._merger,0,0),this._outX.connect(this._merger,0,2),this._outY.connect(this._merger,0,3),this._outZ.connect(this._merger,0,1),this._outX.gain.value=-1,this._outZ.gain.value=-1,this.setRotationMatrix(new Float32Array([1,0,0,0,1,0,0,0,1])),this.input=this._splitter,this.output=this._merger}e.prototype.setRotationMatrix=function(t){this._m0.gain.value=t[0],this._m1.gain.value=t[1],this._m2.gain.value=t[2],this._m3.gain.value=t[3],this._m4.gain.value=t[4],this._m5.gain.value=t[5],this._m6.gain.value=t[6],this._m7.gain.value=t[7],this._m8.gain.value=t[8]},t.exports=e},function(t,i){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";function e(t){this._context=t,this._input=this._context.createGain(),this._context.createIIRFilter?(this._lpf=this._context.createIIRFilter([.00058914319,.0011782864,.00058914319],[1,-1.9029109,.90526748]),this._hpf=this._context.createIIRFilter([.95204461,-1.9040892,.95204461],[1,-1.9029109,.90526748])):(this._lpf=this._context.createBiquadFilter(),this._hpf=this._context.createBiquadFilter(),this._lpf.frequency.value=n,this._hpf.frequency.value=n,this._hpf.type="highpass"),this._splitterLow=this._context.createChannelSplitter(4),this._splitterHigh=this._context.createChannelSplitter(4),this._gainHighW=this._context.createGain(),this._gainHighX=this._context.createGain(),this._gainHighY=this._context.createGain(),this._gainHighZ=this._context.createGain(),this._merger=this._context.createChannelMerger(4),this._input.connect(this._hpf),this._hpf.connect(this._splitterHigh),this._splitterHigh.connect(this._gainHighW,0),this._splitterHigh.connect(this._gainHighX,1),this._splitterHigh.connect(this._gainHighY,2),this._splitterHigh.connect(this._gainHighZ,3),this._gainHighW.connect(this._merger,0,0),this._gainHighX.connect(this._merger,0,1),this._gainHighY.connect(this._merger,0,2),this._gainHighZ.connect(this._merger,0,3),this._input.connect(this._lpf),this._lpf.connect(this._splitterLow),this._splitterLow.connect(this._merger,0,0),this._splitterLow.connect(this._merger,0,1),this._splitterLow.connect(this._merger,0,2),this._splitterLow.connect(this._merger,0,3),this._gainHighW.gain.value=-1*s[0],this._gainHighX.gain.value=-1*s[1],this._gainHighY.gain.value=-1*s[2],this._gainHighZ.gain.value=-1*s[3],this.input=this._input,this.output=this._merger}var n=700,s=[1.4142,.8166,.8166,.8166];t.exports=e},function(t,i){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";function e(t,i){if(2!==i.IR.numberOfChannels)throw"IR does not have 2 channels. cannot proceed.";this._active=!1,this._context=t,this._input=this._context.createChannelSplitter(4),this._cW=this._context.createGain(),this._cX=this._context.createGain(),this._cY=this._context.createGain(),this._cZ=this._context.createGain(),this._convolver=this._context.createConvolver(),this._gain=this._context.createGain(),this._input.connect(this._cW,0),this._input.connect(this._cX,1),this._input.connect(this._cY,2),this._input.connect(this._cZ,3),this._cW.connect(this._convolver),this._cX.connect(this._convolver),this._cY.connect(this._convolver),this._cZ.connect(this._convolver),this._convolver.connect(this._gain),this._gain.connect(this._context.destination),this.enable(),this._convolver.buffer=i.IR,this._gain.gain.value=i.gain,this._cW.gain.value=i.coefficients[0],this._cX.gain.value=i.coefficients[1],this._cY.gain.value=i.coefficients[2],this._cZ.gain.value=i.coefficients[3],this.input=this._input}e.prototype.enable=function(){this._gain.connect(this._context.destination),this._active=!0},e.prototype.disable=function(){this._gain.disconnect(),this._active=!1},t.exports=e},function(t,i,e){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";function n(t,i,e){this._isDecoderReady=!1,this._context=t,this._videoElement=i,this._decodingMode="ambisonic",this._baseResourceUrl=o,this._postGain=s,this._routingDestination=c,e&&(e.baseResourceUrl&&(this._baseResourceUrl=e.baseResourceUrl),e.postGain&&(this._postGain=e.postGain),e.routingDestination&&(this._routingDestination=e.routingDestination)),this._speakerData=[];for(var n=0;n<l.length;++n)this._speakerData.push({name:l[n].name,url:this._baseResourceUrl+"/"+l[n].url,coef:l[n].coef})}var s=26,o="https://raw.githubusercontent.com/google/spatial-media/master/support/hrtfs/cube/",c=[0,1,2,3],a=e(7),h=e(2),r=e(3),_=e(4),u=e(5),l=e(8);n.prototype.initialize=function(){Omnitone.LOG("Initializing... (mode: "+this._decodingMode+")"),this._audioElementSource=this._context.createMediaElementSource(this._videoElement),this._foaRouter=new h(this._context,this._routingDestination),this._foaRotator=new r(this._context),this._foaPhaseMatchedFilter=new _(this._context),this._audioElementSource.connect(this._foaRouter.input),this._foaRouter.output.connect(this._foaRotator.input),this._foaRotator.output.connect(this._foaPhaseMatchedFilter.input),this._foaVirtualSpeakers=[],this._bypass=this._context.createGain(),this._audioElementSource.connect(this._bypass);var t=this;return new Promise(function(i,e){new a(t._context,t._speakerData,function(e){for(var n=0;n<t._speakerData.length;++n)t._foaVirtualSpeakers[n]=new u(t._context,{coefficients:t._speakerData[n].coef,IR:e.get(t._speakerData[n].name),gain:t._postGain}),t._foaPhaseMatchedFilter.output.connect(t._foaVirtualSpeakers[n].input);t.setMode(t._decodingMode),t._isDecoderReady=!0,Omnitone.LOG("Initialized and active."),i()},e)})},n.prototype.setRotationMatrix=function(t){this._foaRotator.setRotationMatrix(t)},n.prototype.setMode=function(t){if(t!==this._decodingMode){switch(t){case"plain":this._decodingMode="plain";for(var i=0;i<this._foaVirtualSpeakers.length;++i)this._foaVirtualSpeakers[i].disable();this._bypass.connect(this._context.destination);break;case"ambisonic":this._decodingMode="ambisonic";for(var i=0;i<this._foaVirtualSpeakers.length;++i)this._foaVirtualSpeakers[i].enable();this._bypass.disconnect();break;case"none":this._decodingMode="none";for(var i=0;i<this._foaVirtualSpeakers.length;++i)this._foaVirtualSpeakers[i].disable();this._bypass.disconnect()}Omnitone.LOG("Decoding mode changed. ("+t+")")}},t.exports=n},function(t,i){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";function e(t,i,e,n,s){this._context=t,this._buffers=new Map,this._loadingTasks={},this._resolve=e,this._reject=n,this._progress=s;for(var o=0;o<i.length;o++){var c=i[o];if(this._loadingTasks.hasOwnProperty(c.name))return void Omnitone.LOG("Duplicated filename when loading: "+c.name);this._loadingTasks[c.name]=0,this._loadAudioFile(c)}}e.prototype._loadAudioFile=function(t){var i=new XMLHttpRequest;i.open("GET",t.url),i.responseType="arraybuffer";var e=this;i.onload=function(){200===i.status?e._context.decodeAudioData(i.response,function(i){Omnitone.LOG("File loaded: "+t.url),e._done(t.name,i)},function(i){Omnitone.LOG("Decoding failure: "+t.url+" ("+i+")"),e._done(t.name,null)}):(Omnitone.LOG("XHR Error: "+t.url+" ("+i.statusText+")"),e._done(t.name,null))},i.onerror=function(i){Omnitone.LOG("XHR Network failure: "+t.url),me._done(t.name,null)},i.send()},e.prototype._done=function(t,i){this._loadingTasks[t]=null!==i?"loaded":"failed",this._buffers.set(t,i),this._updateProgress(t)},e.prototype._updateProgress=function(t){var i=0,e=0,n=0;for(var s in this._loadingTasks)n++,"loaded"===this._loadingTasks[s]?i++:"failed"===this._loadingTasks[s]&&e++;"function"==typeof this._progress&&this._progress(t,i,n),i===n&&this._resolve(this._buffers),i+e===n&&this._reject(this._buffers)},t.exports=e},function(t,i){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
var e=[{name:"E35.26_A45",url:"E35.26_A45_D1.4.wav",coef:[.125,.216494623077544,.216529812402237,-.216494623077545]},{name:"E35.26_A-45",url:"E35.26_A-45_D1.4.wav",coef:[.125,.216494623077544,-.216529812402236,-.216494623077544]},{name:"E35.26_A-135",url:"E35.26_A-135_D1.4.wav",coef:[.125,-.216494623077544,-.216529812402236,-.216494623077545]},{name:"E35.26_A135",url:"E35.26_A135_D1.4.wav",coef:[.125,-.216494623077545,.216529812402237,-.216494623077545]},{name:"E-35.26_A45",url:"E-35.26_A45_D1.4.wav",coef:[.125,.216494623077544,.216529812402237,.216494623077545]},{name:"E-35.26_A-45",url:"E-35.26_A-45_D1.4.wav",coef:[.125,.216494623077544,-.216529812402236,.216494623077545]},{name:"E-35.26_A-135",url:"E-35.26_A-135_D1.4.wav",coef:[.125,-.216494623077544,-.216529812402237,.216494623077545]},{name:"E-35.26_A135",url:"E-35.26_A135_D1.4.wav",coef:[.125,-.216494623077545,.216529812402237,.216494623077545]}];t.exports=e}])});