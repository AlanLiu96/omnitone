!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var e=i();for(var n in e)("object"==typeof exports?exports:t)[n]=e[n]}}(this,function(){return function(t){function i(n){if(e[n])return e[n].exports;var o=e[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}var e={};return i.m=t,i.c=e,i.p="",i(0)}([function(t,i,e){/**
	 * @license
	 * Copyright 2016 Google Inc. All Rights Reserved.
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 *     http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 */
"use strict";i.Omnitone=e(1)},function(t,i,e){"use strict";var n=e(2),o=e(4),s=e(5),r=e(8),a=e(12),h=e(7),c=e(6),_=e(9),l=e(14),u=e(15),g=e(16),p=e(3),d=e(11),f={};f.loadAudioBuffers=function(t,i){return new Promise(function(e,o){new n(t,i,function(t){e(t)},o)})},f.createFOAConvolver=function(t,i){return new o(t,i)},f.createFOARouter=function(t,i){return new c(t,i)},f.createFOARotator=function(t){return new h(t)},f.createFOAPhaseMatchedFilter=function(t){return new r(t)},f.createFOAVirtualSpeaker=function(t,i){return new _(t,i)},f.createFOADecoder=function(t,i,e){return new s(t,i,e)},f.createFOARenderer=function(t,i){return new a(t,i)},f.createHOARotator=function(t,i){return new g(t,i)},f.createHOAConvolver=function(t,i,e){return new l(t,i,e)},f.createHOARenderer=function(t,i){return new u(t,i)},p.log("Omnitone: Version "+d),t.exports=f},function(t,i,e){"use strict";function n(t,i,e,n,s){this._context=t,this._buffers=new Map,this._loadingTasks={},this._resolve=e,this._reject=n,this._progress=s;for(var r=0;r<i.length;r++){var a=i[r];if(this._loadingTasks.hasOwnProperty(a.name))return void o.log("Duplicated filename when loading: "+a.name);this._loadingTasks[a.name]=0,this._loadAudioFile(a)}}var o=e(3);n.prototype._loadAudioFile=function(t){var i=new XMLHttpRequest;i.open("GET",t.url),i.responseType="arraybuffer";var e=this;i.onload=function(){200===i.status?e._context.decodeAudioData(i.response,function(i){e._done(t.name,i)},function(i){o.log("Decoding failure: "+t.url+" ("+i+")"),e._done(t.name,null)}):(o.log("XHR Error: "+t.url+" ("+i.statusText+")"),e._done(t.name,null))},i.onerror=function(i){o.log("XHR Network failure: "+t.url),e._done(t.name,null)},i.send()},n.prototype._done=function(t,i){this._loadingTasks[t]=null!==i?"loaded":"failed",this._buffers.set(t,i),this._updateProgress(t)},n.prototype._updateProgress=function(t){var i=0,e=0,n=0;for(var o in this._loadingTasks)n++,"loaded"===this._loadingTasks[o]?i++:"failed"===this._loadingTasks[o]&&e++;return"function"==typeof this._progress?void this._progress(t,i,n):i===n?void this._resolve(this._buffers):i+e===n?void this._reject(this._buffers):void 0},t.exports=n},function(t,i){"use strict";i.log=function(){window.console.log.apply(window.console,["%c[Omnitone]%c "+Array.prototype.slice.call(arguments).join(" ")+" %c(@"+performance.now().toFixed(2)+"ms)","background: #BBDEFB; color: #FF5722; font-weight: 500","font-weight: 300","color: #AAA"])},i.throw=function(){throw window.console.error.apply(window.console,["%c[Omnitone]%c "+Array.prototype.slice.call(arguments).join(" ")+" %c(@"+performance.now().toFixed(2)+"ms)","background: #C62828; color: #FFEBEE; font-weight: 800","font-weight: 400","color: #AAA"]),!1};var e,n,o,s,r,a,h,c,_,l,u,g,p,d,f,v,m,x,M,R,b,A,y,w,C,O,F,S,H;i.invertMatrix4=function(t,i){return e=i[0],n=i[1],o=i[2],s=i[3],r=i[4],a=i[5],h=i[6],c=i[7],_=i[8],l=i[9],u=i[10],g=i[11],p=i[12],d=i[13],f=i[14],v=i[15],m=e*a-n*r,x=e*h-o*r,M=e*c-s*r,R=n*h-o*a,b=n*c-s*a,A=o*c-s*h,y=_*d-l*p,w=_*f-u*p,C=_*v-g*p,O=l*f-u*d,F=l*v-g*d,S=u*v-g*f,(H=m*S-x*F+M*O+R*C-b*w+A*y)?(H=1/H,t[0]=(a*S-h*F+c*O)*H,t[1]=(o*F-n*S-s*O)*H,t[2]=(d*A-f*b+v*R)*H,t[3]=(u*b-l*A-g*R)*H,t[4]=(h*C-r*S-c*w)*H,t[5]=(e*S-o*C+s*w)*H,t[6]=(f*M-p*A-v*x)*H,t[7]=(_*A-u*M+g*x)*H,t[8]=(r*F-a*C+c*y)*H,t[9]=(n*C-e*F-s*y)*H,t[10]=(p*b-d*M+v*m)*H,t[11]=(l*M-_*b-g*m)*H,t[12]=(a*w-r*O-h*y)*H,t[13]=(e*O-n*w+o*y)*H,t[14]=(d*x-p*R-f*m)*H,t[15]=(_*R-l*x+u*m)*H,t):null},i.getNumberOfChannelsFromAmbisonicOrder=function(t){return(t+1)*(t+1)},i.isBaseAudioContext=function(t){return t instanceof BaseAudioContext},i.isAudioBuffer=function(t){return t instanceof AudioBuffer}},function(t,i){"use strict";function e(t,i){this._context=t,this._active=!1,this._isBufferLoaded=!1,this._buildAudioGraph(),i&&this.setHRIRBufferList(i),this.enable()}e.prototype._buildAudioGraph=function(){this._splitterWYZX=this._context.createChannelSplitter(4),this._mergerWY=this._context.createChannelMerger(2),this._mergerZX=this._context.createChannelMerger(2),this._convolverWY=this._context.createConvolver(),this._convolverZX=this._context.createConvolver(),this._splitterWY=this._context.createChannelSplitter(2),this._splitterZX=this._context.createChannelSplitter(2),this._inverter=this._context.createGain(),this._mergerBinaural=this._context.createChannelMerger(2),this._summingBus=this._context.createGain(),this._splitterWYZX.connect(this._mergerWY,0,0),this._splitterWYZX.connect(this._mergerWY,1,1),this._splitterWYZX.connect(this._mergerZX,2,0),this._splitterWYZX.connect(this._mergerZX,3,1),this._mergerWY.connect(this._convolverWY),this._mergerZX.connect(this._convolverZX),this._convolverWY.connect(this._splitterWY),this._convolverZX.connect(this._splitterZX),this._splitterWY.connect(this._mergerBinaural,0,0),this._splitterWY.connect(this._mergerBinaural,0,1),this._splitterWY.connect(this._mergerBinaural,1,0),this._splitterWY.connect(this._inverter,1,0),this._inverter.connect(this._mergerBinaural,0,1),this._splitterZX.connect(this._mergerBinaural,0,0),this._splitterZX.connect(this._mergerBinaural,0,1),this._splitterZX.connect(this._mergerBinaural,1,0),this._splitterZX.connect(this._mergerBinaural,1,1),this._convolverWY.normalize=!1,this._convolverZX.normalize=!1,this._inverter.gain.value=-1,this.input=this._splitterWYZX,this.output=this._summingBus},e.prototype.setHRIRBufferList=function(t){this._isBufferLoaded||(this._convolverWY.buffer=t[0],this._convolverZX.buffer=t[1],this._isBufferLoaded=!0)},e.prototype.enable=function(){this._mergerBinaural.connect(this._summingBus),this._active=!0},e.prototype.disable=function(){this._mergerBinaural.disconnect(),this._active=!1},t.exports=e},function(t,i,e){"use strict";function n(t,i,e){this._isDecoderReady=!1,this._context=t,this._videoElement=i,this._decodingMode="ambisonic",this._postGainDB=g,this._HRTFSetUrl=u,this._channelMap=s.CHANNEL_MAP.DEFAULT,e&&(e.postGainDB&&(this._postGainDB=e.postGainDB),e.HRTFSetUrl&&(this._HRTFSetUrl=e.HRTFSetUrl),e.channelMap&&(this._channelMap=e.channelMap)),this._speakerData=[];for(var n=0;n<c.length;++n)this._speakerData.push({name:c[n].name,url:this._HRTFSetUrl+"/"+c[n].url,coef:c[n].coef});this._tempMatrix4=new Float32Array(16)}var o=e(2),s=e(6),r=e(7),a=e(8),h=e(9),c=e(10),_=e(3),l=e(11),u="https://raw.githubusercontent.com/GoogleChrome/omnitone/master/build/resources/",g=0;n.prototype.initialize=function(){_.log("Version: "+l),_.log("Initializing... (mode: "+this._decodingMode+")");var t=this._channelMap.toString(),i=s.CHANNEL_MAP.DEFAULT.toString();t!==i&&_.log("Remapping channels (["+i+"] -> ["+t+"])"),this._audioElementSource=this._context.createMediaElementSource(this._videoElement),this._foaRouter=new s(this._context,this._channelMap),this._foaRotator=new r(this._context),this._foaPhaseMatchedFilter=new a(this._context),this._audioElementSource.connect(this._foaRouter.input),this._foaRouter.output.connect(this._foaRotator.input),this._foaRotator.output.connect(this._foaPhaseMatchedFilter.input),this._foaVirtualSpeakers=[],this._bypass=this._context.createGain(),this._audioElementSource.connect(this._bypass);var e=Math.pow(10,this._postGainDB/20);_.log("Gain compensation: "+e+" ("+this._postGainDB+"dB)");var n=this;return new Promise(function(t,i){new o(n._context,n._speakerData,function(i){for(var o=0;o<n._speakerData.length;++o)n._foaVirtualSpeakers[o]=new h(n._context,{coefficients:n._speakerData[o].coef,IR:i.get(n._speakerData[o].name),gain:e}),n._foaPhaseMatchedFilter.output.connect(n._foaVirtualSpeakers[o].input);n.setMode(n._decodingMode),n._isDecoderReady=!0,_.log("HRTF IRs are loaded successfully. The decoder is ready."),t()},i)})},n.prototype.setRotationMatrix=function(t){this._foaRotator.setRotationMatrix(t)},n.prototype.setRotationMatrixFromCamera=function(t){_.invertMatrix4(this._tempMatrix4,t.elements),this._foaRotator.setRotationMatrix4(this._tempMatrix4)},n.prototype.setMode=function(t){if(t!==this._decodingMode){switch(t){case"bypass":this._decodingMode="bypass";for(var i=0;i<this._foaVirtualSpeakers.length;++i)this._foaVirtualSpeakers[i].disable();this._bypass.connect(this._context.destination);break;case"ambisonic":this._decodingMode="ambisonic";for(var i=0;i<this._foaVirtualSpeakers.length;++i)this._foaVirtualSpeakers[i].enable();this._bypass.disconnect();break;case"off":this._decodingMode="off";for(var i=0;i<this._foaVirtualSpeakers.length;++i)this._foaVirtualSpeakers[i].disable();this._bypass.disconnect()}_.log("Decoding mode changed. ("+t+")")}},t.exports=n},function(t,i){"use strict";function e(t,i){this._context=t,this._splitter=this._context.createChannelSplitter(4),this._merger=this._context.createChannelMerger(4),this._channelMap=i||n.DEFAULT,this._splitter.connect(this._merger,0,this._channelMap[0]),this._splitter.connect(this._merger,1,this._channelMap[1]),this._splitter.connect(this._merger,2,this._channelMap[2]),this._splitter.connect(this._merger,3,this._channelMap[3]),this.input=this._splitter,this.output=this._merger}var n={DEFAULT:[0,1,2,3],APPLE:[2,0,1,3],FUMA:[0,3,1,2]};e.prototype.setChannelMap=function(t){t&&(this._channelMap=t,this._splitter.disconnect(),this._splitter.connect(this._merger,0,this._channelMap[0]),this._splitter.connect(this._merger,1,this._channelMap[1]),this._splitter.connect(this._merger,2,this._channelMap[2]),this._splitter.connect(this._merger,3,this._channelMap[3]))},e.CHANNEL_MAP=n,t.exports=e},function(t,i){"use strict";function e(t){this._context=t,this._splitter=this._context.createChannelSplitter(4),this._inY=this._context.createGain(),this._inZ=this._context.createGain(),this._inX=this._context.createGain(),this._m0=this._context.createGain(),this._m1=this._context.createGain(),this._m2=this._context.createGain(),this._m3=this._context.createGain(),this._m4=this._context.createGain(),this._m5=this._context.createGain(),this._m6=this._context.createGain(),this._m7=this._context.createGain(),this._m8=this._context.createGain(),this._outY=this._context.createGain(),this._outZ=this._context.createGain(),this._outX=this._context.createGain(),this._merger=this._context.createChannelMerger(4),this._splitter.connect(this._inY,1),this._splitter.connect(this._inZ,2),this._splitter.connect(this._inX,3),this._inY.gain.value=-1,this._inX.gain.value=-1,this._inY.connect(this._m0),this._inY.connect(this._m1),this._inY.connect(this._m2),this._inZ.connect(this._m3),this._inZ.connect(this._m4),this._inZ.connect(this._m5),this._inX.connect(this._m6),this._inX.connect(this._m7),this._inX.connect(this._m8),this._m0.connect(this._outY),this._m1.connect(this._outZ),this._m2.connect(this._outX),this._m3.connect(this._outY),this._m4.connect(this._outZ),this._m5.connect(this._outX),this._m6.connect(this._outY),this._m7.connect(this._outZ),this._m8.connect(this._outX),this._splitter.connect(this._merger,0,0),this._outY.connect(this._merger,0,1),this._outZ.connect(this._merger,0,2),this._outX.connect(this._merger,0,3),this._outY.gain.value=-1,this._outX.gain.value=-1,this.setRotationMatrix3(new Float32Array([1,0,0,0,1,0,0,0,1])),this.input=this._splitter,this.output=this._merger}e.prototype.setRotationMatrix3=function(t){this._m0.gain.value=t[0],this._m1.gain.value=t[1],this._m2.gain.value=t[2],this._m3.gain.value=t[3],this._m4.gain.value=t[4],this._m5.gain.value=t[5],this._m6.gain.value=t[6],this._m7.gain.value=t[7],this._m8.gain.value=t[8]},e.prototype.setRotationMatrix4=function(t){this._m0.gain.value=t[0],this._m1.gain.value=t[1],this._m2.gain.value=t[2],this._m3.gain.value=t[4],this._m4.gain.value=t[5],this._m5.gain.value=t[6],this._m6.gain.value=t[8],this._m7.gain.value=t[9],this._m8.gain.value=t[10]},e.prototype.getRotationMatrix3=function(){return[this._m0.gain.value,this._m1.gain.value,this._m2.gain.value,this._m3.gain.value,this._m4.gain.value,this._m5.gain.value,this._m6.gain.value,this._m7.gain.value,this._m8.gain.value]},e.prototype.getRotationMatrix4=function(){var t=new Float32Array(16);return t[0]=this._m0.gain.value,t[1]=this._m1.gain.value,t[2]=this._m2.gain.value,t[4]=this._m3.gain.value,t[5]=this._m4.gain.value,t[6]=this._m5.gain.value,t[8]=this._m6.gain.value,t[9]=this._m7.gain.value,t[10]=this._m8.gain.value,t},t.exports=e},function(t,i,e){"use strict";function n(t,i){var e=Math.tan(Math.PI*t/i),n=e*e,o=n+2*e+1;return{lowpassA:[1,2*(n-1)/o,(n-2*e+1)/o],lowpassB:[n/o,2*n/o,n/o],hipassA:[1,2*(n-1)/o,(n-2*e+1)/o],hipassB:[1/o,-2/o,1/o]}}function o(t){if(this._context=t,this._input=this._context.createGain(),this._context.createIIRFilter){var i=n(r,this._context.sampleRate);this._lpf=this._context.createIIRFilter(i.lowpassB,i.lowpassA),this._hpf=this._context.createIIRFilter(i.hipassB,i.hipassA)}else s.log("IIR filter is missing. Using Biquad filter instead."),this._lpf=this._context.createBiquadFilter(),this._hpf=this._context.createBiquadFilter(),this._lpf.frequency.value=r,this._hpf.frequency.value=r,this._hpf.type="highpass";this._splitterLow=this._context.createChannelSplitter(4),this._splitterHigh=this._context.createChannelSplitter(4),this._gainHighW=this._context.createGain(),this._gainHighY=this._context.createGain(),this._gainHighZ=this._context.createGain(),this._gainHighX=this._context.createGain(),this._merger=this._context.createChannelMerger(4),this._input.connect(this._hpf),this._hpf.connect(this._splitterHigh),this._splitterHigh.connect(this._gainHighW,0),this._splitterHigh.connect(this._gainHighY,1),this._splitterHigh.connect(this._gainHighZ,2),this._splitterHigh.connect(this._gainHighX,3),this._gainHighW.connect(this._merger,0,0),this._gainHighY.connect(this._merger,0,1),this._gainHighZ.connect(this._merger,0,2),this._gainHighX.connect(this._merger,0,3),this._input.connect(this._lpf),this._lpf.connect(this._splitterLow),this._splitterLow.connect(this._merger,0,0),this._splitterLow.connect(this._merger,1,1),this._splitterLow.connect(this._merger,2,2),this._splitterLow.connect(this._merger,3,3);var e=this._context.currentTime;this._gainHighW.gain.setValueAtTime(-1*a[0],e),this._gainHighY.gain.setValueAtTime(-1*a[1],e),this._gainHighZ.gain.setValueAtTime(-1*a[2],e),this._gainHighX.gain.setValueAtTime(-1*a[3],e),this.input=this._input,this.output=this._merger}var s=e(3),r=690,a=[1.4142,.8166,.8166,.8166];t.exports=o},function(t,i){"use strict";function e(t,i){if(2!==i.IR.numberOfChannels)throw"IR does not have 2 channels. cannot proceed.";this._active=!1,this._context=t,this._input=this._context.createChannelSplitter(4),this._cW=this._context.createGain(),this._cY=this._context.createGain(),this._cZ=this._context.createGain(),this._cX=this._context.createGain(),this._convolver=this._context.createConvolver(),this._gain=this._context.createGain(),this._input.connect(this._cW,0),this._input.connect(this._cY,1),this._input.connect(this._cZ,2),this._input.connect(this._cX,3),this._cW.connect(this._convolver),this._cY.connect(this._convolver),this._cZ.connect(this._convolver),this._cX.connect(this._convolver),this._convolver.connect(this._gain),this._gain.connect(this._context.destination),this.enable(),this._convolver.normalize=!1,this._convolver.buffer=i.IR,this._gain.gain.value=i.gain,this._cW.gain.value=i.coefficients[0],this._cY.gain.value=i.coefficients[1],this._cZ.gain.value=i.coefficients[2],this._cX.gain.value=i.coefficients[3],this.input=this._input}e.prototype.enable=function(){this._gain.connect(this._context.destination),this._active=!0},e.prototype.disable=function(){this._gain.disconnect(),this._active=!1},t.exports=e},function(t,i){var e=[{name:"E35_A135",url:"E35_A135.wav",gainFactor:1,coef:[.125,.216495,.21653,-.216495]},{name:"E35_A-135",url:"E35_A-135.wav",gainFactor:1,coef:[.125,-.216495,.21653,-.216495]},{name:"E-35_A135",url:"E-35_A135.wav",gainFactor:1,coef:[.125,.216495,-.21653,-.216495]},{name:"E-35_A-135",url:"E-35_A-135.wav",gainFactor:1,coef:[.125,-.216495,-.21653,-.216495]},{name:"E35_A45",url:"E35_A45.wav",gainFactor:1,coef:[.125,.216495,.21653,.216495]},{name:"E35_A-45",url:"E35_A-45.wav",gainFactor:1,coef:[.125,-.216495,.21653,.216495]},{name:"E-35_A45",url:"E-35_A45.wav",gainFactor:1,coef:[.125,.216495,-.21653,.216495]},{name:"E-35_A-45",url:"E-35_A-45.wav",gainFactor:1,coef:[.125,-.216495,-.21653,.216495]}];t.exports=e},function(t,i){"use strict";t.exports="0.9.5"},function(t,i,e){"use strict";function n(t,i){this._context=c.isBaseAudioContext(t)?t:c.throw("FOARenderer: Invalid BaseAudioContext."),this._config={},i.channelMap&&Array.isArray(i.channelMap)?this._config.channelMap=i.channelMap:this._config.channelMap=a.CHANNEL_MAP.DEFAULT,i.hrirPathList?Array.isArray(i.hrirPathList)&&2===i.hrirPathList.length?this._config.pathList=i.hrirPathList:c.throw("FOARenderer: Invalid HRIR URLs. It must be an array with 2 URLs to HRIR files. (got "+i.hrirPathList+")"):this._config.pathList=h.getPathList(),i.renderingMode&&Object.values(_).includes(i.renderingMode)?this._config.renderingMode=i.renderingMode:(this._config.renderingMode=_.AMBISONIC,c.log("FOARenderer: Invalid rendering mode order. (got"+i.renderingMode+') Fallbacks to the mode "ambisonic".')),this._buildAudioGraph(),this._tempMatrix4=new Float32Array(16),this._isRendererReady=!1}var o=e(2),s=e(4),r=e(7),a=e(6),h=e(13),c=e(3),_={AMBISONIC:"ambisonic",BYPASS:"bypass",OFF:"off"};n.prototype._buildAudioGraph=function(){this.input=this._context.createGain(),this.output=this._context.createGain(),this._bypass=this._context.createGain(),this._foaRouter=new a(this._context,this._config.channelMap),this._foaRotator=new r(this._context),this._foaConvolver=new s(this._context),this.input.connect(this._foaRouter.input),this.input.connect(this._bypass),this._foaRouter.output.connect(this._foaRotator.input),this._foaRotator.output.connect(this._foaConvolver.input),this._foaConvolver.output.connect(this.output)},n.prototype._initializeCallback=function(t,i){for(var e=[],n=0;n<this._config.pathList.length;++n)e.push({name:n,url:this._config.pathList[n]});var s=[];new o(this._context,e,function(i){for(var n=0;n<e.length;++n)s.push(i.get(n));this._foaConvolver.setHRIRBufferList(s),this.setRenderingMode(this._config.renderingMode),this._isRendererReady=!0,c.log("FOARenderer: HRIRs loaded successfully. Ready."),t()}.bind(this),function(t){var e="FOARenderer: HRIR loading/decoding failed. ("+Array.from(t)+")";c.throw(e),i(e)})},n.prototype.initialize=function(){return c.log("FOARenderer: Initializing... (mode: "+this._config.renderingMode+")"),new Promise(this._initializeCallback.bind(this),function(t){c.throw("FOARenderer: Initialization failed. ("+t+")")})},n.prototype.setChannelMap=function(t){this._isRendererReady&&t.toString()!==this._config.channelMap.toString()&&(c.log("Remapping channels (["+this._config.channelMap.toString()+"] -> ["+t.toString()+"])."),this._config.channelMap=t.slice(),this._foaRouter.setChannelMap(this._config.channelMap))},n.prototype.setRotationMatrix3=function(t){this._isRendererReady&&this._foaRotator.setRotationMatrix3(t)},n.prototype.setRotationMatrix4=function(t){this._isRendererReady&&this._foaRotator.setRotationMatrix4(t)},n.prototype.setRotationMatrixFromCamera=function(t){this._isRendererReady&&(c.invertMatrix4(this._tempMatrix4,t.elements),this._foaRotator.setRotationMatrix4(this._tempMatrix4))},n.prototype.setRenderingMode=function(t){if(t!==this._config.renderingMode){switch(t){case _.AMBISONIC:this._foaConvolver.enable(),this._bypass.disconnect();break;case _.BYPASS:this._foaConvolver.disable(),this._bypass.connect(this.output);break;case _.OFF:this._foaConvolver.disable(),this._bypass.disconnect();break;default:return void c.log('FOARenderer: Rendering mode "'+t+'" is not supported.')}this._config.renderingMode=t,c.log("FOARenderer: Rendering mode changed. ("+t+")")}},t.exports=n},function(t,i){"use strict";var e=[null,["omnitone-foa-1.wav","omnitone-foa-2.wav"],["omnitone-soa-1.wav","omnitone-soa-2.wav","omnitone-soa-3.wav","omnitone-soa-4.wav","omnitone-soa-5.wav"],["omnitone-toa-1.wav","omnitone-toa-2.wav","omnitone-toa-3.wav","omnitone-toa-4.wav","omnitone-toa-5.wav","omnitone-toa-6.wav","omnitone-toa-7.wav","omnitone-toa-8.wav"]],n={GSTATIC:"https://www.gstatic.com/external_hosted/omnitone/build/resources/",GITHUB:"https://cdn.rawgit.com/GoogleChrome/omnitone/master/build/resources/"};t.exports.getPathList=function(t){var i,o,s,r=t||{ambisonicOrder:1,source:"github"};switch(r.ambisonicOrder){case 1:case 2:case 3:i=e[r.ambisonicOrder];break;default:i=e[0]}switch(r.source){case"gstatic":o=n.GSTATIC;break;case"github":default:o=n.GITHUB}return i&&(s=[],i.forEach(function(t){s.push(o+t)})),s}},function(t,i){"use strict";function e(t,i,e){this._context=t,this._active=!1,this._isBufferLoaded=!1,this._ambisonicOrder=i,this._numberOfChannels=(this._ambisonicOrder+1)*(this._ambisonicOrder+1),this._buildAudioGraph(),e&&this.setHRIRBufferList(e),this.enable()}e.prototype._buildAudioGraph=function(){var t=Math.ceil(this._numberOfChannels/2);this._inputSplitter=this._context.createChannelSplitter(this._numberOfChannels),this._stereoMergers=[],this._convolvers=[],this._stereoSplitters=[],this._positiveIndexSphericalHarmonics=this._context.createGain(),this._negativeIndexSphericalHarmonics=this._context.createGain(),this._inverter=this._context.createGain(),this._binauralMerger=this._context.createChannelMerger(2),this._outputGain=this._context.createGain();for(var i=0;i<t;++i)this._stereoMergers[i]=this._context.createChannelMerger(2),this._convolvers[i]=this._context.createConvolver(),this._stereoSplitters[i]=this._context.createChannelSplitter(2),this._convolvers[i].normalize=!1;for(var e=0;e<=this._ambisonicOrder;++e)for(var n=-e;n<=e;n++){var o=e*e+e+n,s=Math.floor(o/2);this._inputSplitter.connect(this._stereoMergers[s],o,o%2),this._stereoMergers[s].connect(this._convolvers[s]),this._convolvers[s].connect(this._stereoSplitters[s]),n>=0?this._stereoSplitters[s].connect(this._positiveIndexSphericalHarmonics,o%2):this._stereoSplitters[s].connect(this._negativeIndexSphericalHarmonics,o%2)}this._positiveIndexSphericalHarmonics.connect(this._binauralMerger,0,0),this._positiveIndexSphericalHarmonics.connect(this._binauralMerger,0,1),this._negativeIndexSphericalHarmonics.connect(this._binauralMerger,0,0),this._negativeIndexSphericalHarmonics.connect(this._inverter),this._inverter.connect(this._binauralMerger,0,1),this._inverter.gain.value=-1,this.input=this._inputSplitter,this.output=this._outputGain},e.prototype.setHRIRBufferList=function(t){if(!this._isBufferLoaded){for(var i=0;i<t.length;++i)this._convolvers[i].buffer=t[i];this._isBufferLoaded=!0}},e.prototype.enable=function(){this._binauralMerger.connect(this._outputGain),this._active=!0},e.prototype.disable=function(){this._binauralMerger.disconnect(),this._active=!1},t.exports=e},function(t,i,e){"use strict";function n(t,i){this._context=h.isBaseAudioContext(t)?t:h.throw("FOARenderer: Invalid BaseAudioContext."),this._config={},i.ambisonicOrder&&_.includes(i.ambisonicOrder)?this._config.ambisonicOrder=i.ambisonicOrder:(this._config.ambisonicOrder=3,h.log("HOARenderer: Invalid ambisonic order. (got "+i.ambisonicOrder+") Fallbacks to 3rd-order ambisonic.")),this._config.numberOfChannels=(this._config.ambisonicOrder+1)*(this._config.ambisonicOrder+1),this._config.numberOfStereoChannels=Math.ceil(this._config.numberOfChannels/2),i.hrirPathList?Array.isArray(i.hrirPathList)&&i.hrirPathList.length===this._config.numberOfStereoChannels?this._config.pathList=i.hrirPathList:h.throw("HOARenderer: Invalid HRIR URLs. It must be an array with "+this._config.numberOfStereoChannels+" URLs to HRIR files. (got "+i.hrirPathList+")"):this._config.pathList=a.getPathList({ambisonicOrder:this._config.ambisonicOrder}),i.renderingMode&&Object.values(c).includes(i.renderingMode)?this._config.renderingMode=i.renderingMode:this._config.renderingMode=c.AMBISONIC,this._buildAudioGraph(),this._isRendererReady=!1}var o=e(2),s=e(14),r=e(16),a=e(13),h=e(3),c={AMBISONIC:"ambisonic",BYPASS:"bypass",OFF:"off"},_=[2,3];n.prototype._buildAudioGraph=function(){this.input=this._context.createGain(),this.output=this._context.createGain(),this._bypass=this._context.createGain(),this._hoaRotator=new r(this._context,this._config.ambisonicOrder),this._hoaConvolver=new s(this._context,this._config.ambisonicOrder),this.input.connect(this._hoaRotator.input),this.input.connect(this._bypass),this._hoaRotator.output.connect(this._hoaConvolver.input),this._hoaConvolver.output.connect(this.output)},n.prototype._initializeCallback=function(t,i){for(var e=[],n=0;n<this._config.pathList.length;++n)e.push({name:n,url:this._config.pathList[n]});var s=[];new o(this._context,e,function(i){for(var n=0;n<e.length;++n)s.push(i.get(n));this._hoaConvolver.setHRIRBufferList(s),this.setRenderingMode(this._config.renderingMode),this._isRendererReady=!0,h.log("HOARenderer: HRIRs loaded successfully. Ready."),t()}.bind(this),function(t){var e="HOARenderer: HRIR loading/decoding failed. ("+Array.from(t)+")";h.throw(e),i(e)})},n.prototype.initialize=function(){return h.log("HOARenderer: Initializing... (mode: "+this._config.renderingMode+", ambisonic order: "+this._config.ambisonicOrder+")"),new Promise(this._initializeCallback.bind(this),function(t){h.throw("FOARenderer: Initialization failed. ("+t+")")})},n.prototype.setRotationMatrix3=function(t){this._isRendererReady&&this._hoaRotator.setRotationMatrix3(t)},n.prototype.setRotationMatrix4=function(t){this._isRendererReady&&this._hoaRotator.setRotationMatrix4(t)},n.prototype.setRenderingMode=function(t){if(t!==this._config.renderingMode){switch(t){case c.AMBISONIC:this._hoaConvolver.enable(),this._bypass.disconnect();break;case c.BYPASS:this._hoaConvolver.disable(),this._bypass.connect(this.output);break;case c.OFF:this._hoaConvolver.disable(),this._bypass.disconnect();break;default:return void h.log('HOARenderer: Rendering mode "'+t+'" is not supported.')}this._config.renderingMode=t,h.log("HOARenderer: Rendering mode changed. ("+t+")")}},t.exports=n},function(t,i){"use strict";function e(t,i){return t===i?1:0}function n(t,i,e,n,o){var s=(n+i)*(2*i+1)+(e+i);t[i-1][s].gain.value=o}function o(t,i,e,n){var o=(n+i)*(2*i+1)+(e+i);return t[i-1][o].gain.value}function s(t,i,e,n,s){return n===s?o(t,1,i,1)*o(t,s-1,e,s-1)-o(t,1,i,-1)*o(t,s-1,e,-s+1):n===-s?o(t,1,i,1)*o(t,s-1,e,-s+1)+o(t,1,i,-1)*o(t,s-1,e,s-1):o(t,1,i,0)*o(t,s-1,e,n)}function r(t,i,e,n){return s(t,0,i,e,n)}function a(t,i,n,o){if(0===i)return s(t,1,1,n,o)+s(t,-1,-1,n,o);if(i>0){var r=e(i,1);return s(t,1,i-1,n,o)*Math.sqrt(1+r)-s(t,-1,-i+1,n,o)*(1-r)}var r=e(i,-1);return s(t,1,i+1,n,o)*(1-r)+s(t,-1,-i-1,n,o)*Math.sqrt(1+r)}function h(t,i,e,n){return 0===i?0:i>0?s(t,1,i+1,e,n)+s(t,-1,-i-1,e,n):s(t,1,i-1,e,n)-s(t,-1,-i+1,e,n)}function c(t,i,n){var o=e(t,0),s=Math.abs(i)===n?1/(2*n*(2*n-1)):1/((n+i)*(n-i));return[Math.sqrt((n+t)*(n-t)*s),.5*(1-2*o)*Math.sqrt((1+o)*(n+Math.abs(t)-1)*(n+Math.abs(t))*s),-.5*(1-o)*Math.sqrt((n-Math.abs(t)-1)*(n-Math.abs(t)))*s]}function _(t,i){for(var e=-i;e<=i;e++)for(var o=-i;o<=i;o++){var s=c(e,o,i);Math.abs(s[0])>0&&(s[0]*=r(t,e,o,i)),Math.abs(s[1])>0&&(s[1]*=a(t,e,o,i)),Math.abs(s[2])>0&&(s[2]*=h(t,e,o,i)),n(t,i,e,o,s[0]+s[1]+s[2])}}function l(t){for(var i=2;i<=t.length;i++)_(t,i)}function u(t,i){this._context=t,this._ambisonicOrder=i;var e=(i+1)*(i+1);this._splitter=this._context.createChannelSplitter(e),this._merger=this._context.createChannelMerger(e),this._gainNodeMatrix=[];for(var n,o,s,r,a,h=1;h<=i;h++){n=h*h,o=2*h+1,this._gainNodeMatrix[h-1]=[];for(var c=0;c<o;c++){s=n+c;for(var _=0;_<o;_++)r=n+_,a=c*o+_,this._gainNodeMatrix[h-1][a]=this._context.createGain(),this._splitter.connect(this._gainNodeMatrix[h-1][a],s),this._gainNodeMatrix[h-1][a].connect(this._merger,0,r)}}this._splitter.connect(this._merger,0,0),this.setRotationMatrix3(new Float32Array([1,0,0,0,1,0,0,0,1])),this.input=this._splitter,this.output=this._merger}u.prototype.setRotationMatrix3=function(t){for(var i=0;i<9;++i)this._gainNodeMatrix[0][i].gain.value=t[i];l(this._gainNodeMatrix)},u.prototype.setRotationMatrix4=function(t){this._gainNodeMatrix[0][0].gain.value=t[0],this._gainNodeMatrix[0][1].gain.value=t[1],this._gainNodeMatrix[0][2].gain.value=t[2],this._gainNodeMatrix[0][3].gain.value=t[4],this._gainNodeMatrix[0][4].gain.value=t[5],this._gainNodeMatrix[0][5].gain.value=t[6],this._gainNodeMatrix[0][6].gain.value=t[8],this._gainNodeMatrix[0][7].gain.value=t[9],this._gainNodeMatrix[0][8].gain.value=t[10],l(this._gainNodeMatrix)},u.prototype.getRotationMatrix3=function(){for(var t=new Float32Array(9),i=0;i<9;++i)t[i]=this._gainNodeMatrix[0][i].gain.value;return t},u.prototype.getRotationMatrix4=function(){var t=new Float32Array(16);return t[0]=this._gainNodeMatrix[0][0].gain.value,t[1]=this._gainNodeMatrix[0][1].gain.value,t[2]=this._gainNodeMatrix[0][2].gain.value,t[4]=this._gainNodeMatrix[0][3].gain.value,t[5]=this._gainNodeMatrix[0][4].gain.value,t[6]=this._gainNodeMatrix[0][5].gain.value,t[8]=this._gainNodeMatrix[0][6].gain.value,t[9]=this._gainNodeMatrix[0][7].gain.value,t[10]=this._gainNodeMatrix[0][8].gain.value,t},u.prototype.getAmbisonicOrder=function(){return this._ambisonicOrder},t.exports=u}])});